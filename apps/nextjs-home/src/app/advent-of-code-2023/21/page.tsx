import Link from 'next/link'

const REAL_INPUT = `...................................................................................................................................
..##.#..#.....#.##......#........##.....#..#....##..................................#..#....................#.......#.##.#.......#.
..............#....#...#...##.....#...........#.#........................#.................#......#...........##.#.#............#..
.......#...#..........#.#....#..........##.........#.#........................#...............#....#..#.#...........#...##...#.....
.....#....#..#..#...........#..................#.............................#.........#.#........#...#...#..............#.........
...#......#......##.#....................#..#..#......#...........#................#....#......##...#...........#.....#.#......##..
...#...#..##......#..........#..#...........#.#......#.....................##..#.#.......................#.##........##.........#..
........#...#.....#....##......#...........#.#...#..#..................................#......#..##.#.........#.......#............
..#.###....##...#......#...........#......#........#.#.........#...#.#..............#..#.........#.........#.......##..#...........
.#...............##...#........#......##.........#..................#..............#....#........#........#...#.............#......
.....#.........#.......##......#.........##..#..............#......................#..#....#........###.##.#..................##...
.#..............#.#.#.#...............#....................#..#....##.#.........##....#................#........#......#.....#.....
........#..#..###...........#......#.#......#..............#...#.........#.......#....#........#..##............#....#......##.....
...#...#....#......#....#...................#.#............##........#..........................#......##.........#..#..#..........
.##...#............##..#.#.........##.....#..##.........................#............#.....#...#........#..#.......#.....#.........
..........####..#.....#....###...#.....##.....#..............#.#.............................##..#...##.##..#...#.........#........
............#....#...#........#........#....#..................##..#.##.................#........#....#..#........#.#.#...#..#.##..
...#.....#.....#..........#....#.#......#................#..###.#.#.#..##.................#...#.......##.#....#....#......#..#...#.
.#..###.#............................#.#............#.....#.......#...#.....#..#.........#........#........#..........###.....#....
.#...###.#.....#.........#..............................#................#...##.................#..#..#.....#.##....##.#...........
.....#.##...#.............#........#................#.#..................#.#.#.#.........##...........##.........##.......##....#..
.........#.#........####.#.##.....#....##.......#.......###.#.............#.................#.....#..###.#...............##......#.
.....#............#..#...#.##....#.............#...#...#..##.......#..............#........#...##...#...............##.......#.#...
..###...#..#..#.#........#.........#..........#.##.#..............#.#.#.........#.##..........#.#.......................#..........
.........#.......#......#.#..#...#...................#....#........#..............#............#..##.........#..#..#..#............
..#......#..##......##.#.##.###..#.#............#..#.........#............#.#......#..............#...#.##.....##.#.....#..........
..#......#..#.#....##...#.....##..............#...........#........###...##.....#.................##..#.....#.#......##.#...#......
..............#......##..##.......#.........##..#..#...............#....#..............................#......#.#.##.......#..#..#.
......#...............#.#......#..........##..#.....#..##...#........#..#.#..##....#...................##.##...#..........####..#..
.........#..#.......#...........#...........#.##..................#.............#.#...................#..........#.....#.........#.
.......#.......#..#.#.#.#..#.............##..#..........#.#...........#.........##..................#.......#.......##.........#...
.#.....................##....#........#....#.....#....#........##..#.....#....#.......#...#..............#.................#.#..#..
.#..........#...#...#........#.........##.....#.#..#....#...####......#....#...............#....................................#..
..#.#..#...#..#.............#.......##..#........#...#....#....#...##.#..........##.....#...##........#...##.....#....#..#...#.#...
...#...................#................#.............#.............#.......................##.........#................#...#......
.............##....##.....................##.....#..#..#.####......##..#............#...#..................#.##.#.#..#...##.##.....
..#......#......#......#................#.#......##........#.#..................#.............#..#........#...........#.....##.....
.......#..##....................#...#.#................#.................#.#.#..#...#.......#...................................#..
.....#..#..#..#....#...........#.......##...........................#.#......#.......#......#....................##.#......#.......
............##......##...................##.......#.........#.#......#...#..........#..##.......#..#............#.........###....#.
..............................#.##........#.#.............#....#.......................#...#..#.....#.................#...#.....##.
..##....#....#.#....................#........................#.#.....#...#.##..#.....#......#.#..................#.................
.##...#....##......#..........##......#...#......#....#............#...#.#.....#..............#........#............##........#..#.
.##..............#................#..................#...#......#.....#..##........#............#....#.............#.#..####.......
......#......#.#...........#..#.........#.....#....#....#.....#....#.............#.......#...#.#....#...................#....#.....
.#....#..#..............#...##.....#.........#..#.........................#..#.........#.................##........##..........##..
.............#.#................##.#......#.....................#.#..........#.#..##.....#.##.#.#.##.#....#................#.....#.
.......#....................#.##...................###....#...........#............#......#...........#....#..................#....
...##..#...............##...#.........#.#..........##...#.....##..#......#...#.#..#.......#.......#.......................#..#...#.
......#..#...........###.........#.#...#..........#.....#...#.##..#..........#.........#..............#...................#........
....#...#..#.............#...............................#...##...#......#..#....#.#............#........##.#..........###.........
........#........................#.#.#..............#...............#....#...#.....#..#.#....................#.............#...#...
..#...............#..##.....##..........#....#.###................#....#.#..#.#........##.##............#...#.#..............#.....
.##................#.......#.............#..##........................#......##...#......#.#..........#.#.#..#..............#..#...
...............##..###.#......##.#......#...............#...#.##........#...#.#...#.......#..###........#.#...#............#...#...
..##.#.............#.........#..........##.......#....#...#.#.#...#......#.....#...#.#.........#....#......##.#...............#.#..
.#...........#.........#..#.#...##.......#.............#..........#...##...#...#...#.....#........##...#......#.#....#.............
.#................#...............#............##..#..#....##............#........#....#..#......#.....#......#.##...#.........#.#.
.#.........##...#.#.##...........#..........#...#.......#...#..........#...............#.......#.......#.#.##....#..#...........#..
..#...........##..#.....#.......#...................#..............#...#.#...##.#.......#.#......#................#..#..........#..
............#............#.....#.#.#........##.......#..#..#.........#......#.............##..##......#......#..#.#................
........##...........#......##.......#.....#...................#...#.........#.###..........####..##.....#....#........#...........
.........#.......#.#..........................#.#.............#......#..#.....#......#..........#.............#.....#..............
........#...#...#........#..#................#..#...#.......#......##.#...#.#........#............#.....#.#........#...............
.......................#...........#...#.#.......#.........#...##......#...#..#.......................#..#......#..........#.......
.................................................................S.................................................................
..........#...........#......#............................#..##.....#...#.#.#...........#..........##.......#.........#..##.#......
.......#.....#.........##.#........#.....#....#..#.....#...#...#.......##..#.......##..#.........#..##.................#...........
................................##...................#.......#.......##..............#...................##......#.................
.............#........#......##.....#...#...#..........##.......#.#........#.........#.......#....##...........#......#...#........
..............#................#...#....#....#..............#.........#....#...................#..........#...........#............
..................#...#.#..#.#...............##.....#.....#..##.......#.#...##....#.........##.............#.......................
............#......###.#...#...#......#....##........#..#####.#.#......#.#.#...#.#......#........#...#..#.#.#.#......#..........#..
....#.................##........#..#..#..........##.###...#...#.#.....##.................#...#.......#.#.............#.............
.#...........#..#..#...#.#..........#.#.#.###............#...........#..#.................#.....#.....#..#.........................
...#.................##..#.#....#.......###..#.#.............#.....#....#.#.#............#.......##.....#.#..#......#........#.....
......#.................#.........#...#..............#.#.###..#......#...#.##..............#....##......#....#...#.............#...
........#..............#.#.......#.#.#...........#........................##..#....#..#...#..#.#...........#....#.#...........#....
..#.#.............#...............#........#.........#................##.........#....#...#.....##.......#................#..#.#.#.
.#..#................#...#..#...........#..#.....#..........#.....#..#...#.###....###.....##..##.........#...#.....................
....#...#...........#.....................#..#...........##........#.......#.#.....##.......#..###...#.........................#.#.
....#.##.#.............##.....#.......#.#......#.##..........###..##.##...............#...##....#...#...................##.........
....#...................#....#.#.#.......#...........#......#........#.#.#..#.....#.#.....#.##..##.#.....#..#........##..#..#.#.#..
..........#................#..#.#.....#.#....#........#....##.#..................#.................#.....#...............#...#.....
.........#...#.................................#.....#..#...........##...#.........#..#....#..#....#......#..........##....#...#...
...........#...#...........#.......#......#..............#........##.....#.......................##................#...........##..
..###......#..#.............##.##..#.#..##.......###..###...#..#...##.#...#.................#..........#............#..............
..#........##..#..........#.#......#..#..#...##.........#.#.................#.........#......#.#.................#........##...#...
..........#.................#..#..............#...........#.....#....#............##...#......#...................#........#.#.....
...........#.......##.........#.#..#...##...........#.....#...........#..............##.....#..##..................#..#.##..#......
..#.............#...#...............................#...........#...............#....................................##.....#......
...#......#........#...............#..#...#.......#.....###..#..#.#.#................#.#..........#.........................#..#...
...#................................#..#.....#......#..###.#........###...............#..........#.........#.....#.##....##........
.................#..#...........#...#.................#..#..#..#.......#..........#.........................#......#........#......
...#.#...#..#..#..#......#.......#.....#.......##.....##.....#.....#.....#.....#...............#...........................#.....#.
.#....#....##..#..#.##...#...........#.#.....#....#..................#..##....#.#..........##....................###......##.......
..#..#.#..............#............#..............##..............#..............#...............................#...........##.#..
.#.....#.#.#.#..##.#.#..................#........##.#...............#....#..#.....#..###..............................#...##.#.....
..#......#.........##....................##..##.......#.....#..............................#...............#....#.........#........
.....#.#.........#....##....##...............#.#.......#..........#......#..#..........#....#..........##.#.#.............#.....##.
..#.#.....#.........#.....#.#............#......#....#.....#...........#...............................#.....#.#...........#.....#.
......#......#....#...#....#............#.#....#............#..............#....#.........#.......#...#.#.......#.#.#........#.....
.........#..#........##...................#..#...#.#.....##.............#....#......#....................#.##....##....#...........
..#......#...........#.#...................#......#.#..##..#...#.......#.#......#.......#.........#....#.........#.#...#.##.#.#.#..
.......#......#..##.#........#.##.................#.#..#.#...#..........#......................#....#....#.........#......#........
.#.#......#................#...#....#.........#.....................##..##..........##............#.#.........#.......#......#...#.
...#..#.#..##...#............##...............#..##..........#..........##.#...##....#........#.........##.#...#....#.........#....
...#....#........#.........#.....##...#...........#.###.............#............#.#..............#..#.........#.....#...#....#....
...........#.................##.##....#.................#..........##....#.....#...........................#...#....#.......#......
..#......#...#...................................#.###.##......#.....#..##................#..#.......#....##....###......#...#.....
....#......#.....#.#..#..........#.....#.........#.....#..#..........#......#.#.............#..##.####.#.##.......#.......###..#...
...........#..#...#.##.................##.............#....##...#.#......#...............#.....##...#......#..#....................
............###.......#.#..#............#..#............#............#...#..##....................###....##..........#.#.#....#....
.#..#......#..#........................................#..#..#.....#.#...#.............##...........#..#...#......#....#.......#.#.
..............#..........#..............#...##..........###.#...#...##...............#...#.........#.#........###.........##..#....
........#..............##..............##....................#......#......#...........##..##.....#......#.....#.........##....#.#.
....#.#............#............#........#....#........#....#............#.................#...#.......#..#....#...#.......##....#.
........#......#.##....#.#..#.....#...#.........#.......#...........#..................##..##...###..#.##.....#....................
.......#.#....#...#..#......#...........#.#..#...#.......#...#.##..#..................#...#....#.......#.#..............#......#...
...#..#..#..............#....#.#....#..#......#..#.............#...#..#..........#.......................#..#.....#.....#........#.
......#.#.....#.......#..#..............#......................#......................#.....#.....##.......#.##..#.................
..#........#..#................#...........#....#............##...###............................#..#.......#..#...................
..#..##..#.##.....#...........##....###...#.#..#..................#.............#.....#..........#...........#...#...###...........
.....#....#.....#.......#...#......##..............#...............##.......#....#.....#.......#....#.#........#.....#..#.....#....
...............##.#.........##...#....##.#.#......................................##..#..##...#.##.......##.................##.....
...................#.....#..........#......#.#.#.#............................##....#.##..#.#..............#...##.....#..#..#......
.#...#...#.....#.........#..............#..........##.......................#..#..#........##..#.............##...#.........#......
.#..#...#....##.......##...........#.##........##..##...................#...#..#...#.....#.#...#........####.#...#........#..#.#...
....#.......##..#....##....#.....#..#..#.#..#.#..........#...............##.#..###...#..........#...#....#...#................##...
......#..#......#.#.....##....#.............#.##........................#.##.#...#...#....##.......##.#..................#..#..#...
...................................................................................................................................`

const SAMPLE_INPUT = `...........
.....###.#.
.###.##..#.
..#.#...#..
....#.#....
.##..S####.
.##..#...#.
.......##..
.##.#.####.
.##..##.##.
...........`

const sumIt = (prev: number, item: number) => prev + item

const useTestInput = false
const input = useTestInput ? SAMPLE_INPUT : REAL_INPUT

type rowsType = string[][]
const printRows = (rows: rowsType) => {
  console.log(
    rows
      .map(
        //
        (cells) =>
          cells
            //
            .join('')
        // .replaceAll('.', ' ')
      )
      .join('\n')
  )
}
const takeSteps = (rows: rowsType, stepsToTake: number, printIt = true) => {
  while (stepsToTake > 0) {
    // console.log(`steps left: ${stepsToTake}`)
    stepsToTake--
    const previousRows = rows.map((cells) => [...cells])
    for (let y = 0; y < rows.length; y++) {
      for (let x = 0; x < rows[0].length; x++) {
        const stepUpdate = (y: number, x: number) => {
          if (previousRows?.[y]?.[x] === '.') {
            rows[y][x] = 'O'
          }
        }
        const isElf = previousRows?.[y]?.[x] === 'O'
        if (isElf) {
          rows[y][x] = '.'
          stepUpdate(y - 1, x)
          stepUpdate(y + 1, x)
          stepUpdate(y, x - 1)
          stepUpdate(y, x + 1)
        }
      }
    }
    if (printIt) {
      printRows(rows)
      console.log('===')
    }
  }
  return rows
}

let startRows = input.split('\n').map((line) => {
  return line.split('').map((d) => {
    if (d === 'S') {
      return 'O'
    }
    return d
  })
})
console.time('part1')
takeSteps(startRows, 65)
const part1 = startRows
  .map((cells) => cells.filter((cell) => cell === 'O').length)
  .reduce(sumIt, 0)
console.log(part1)
console.timeLog('part1')

let topRows = input.split('\n').map((line) => {
  const rowWithoutStart = line.replace('S', '.')
  return rowWithoutStart + rowWithoutStart + rowWithoutStart
})
let midRows = input.split('\n').map((line) => {
  const rowWithoutStart = line.replace('S', '.')
  const rowWithStart = line.replace('S', 'O')
  return rowWithoutStart + rowWithStart + rowWithoutStart
})
let bottomRows = input.split('\n').map((line) => {
  const rowWithoutStart = line.replace('S', '.')
  return rowWithoutStart + rowWithoutStart + rowWithoutStart
})
let allRows = topRows.concat(midRows, bottomRows).map((row) => row.split(''))
console.time('part2')
const ONE_SPAN = 131
const STEPS_TO_GO_ONE_SPAN = (ONE_SPAN - 1) / 2
// const STEPS_TO_SPAN_ONE_TESSELATION = Math.floor(ONE_SPAN / 2)
// @ts-ignore
const TOTAL_STEPS = 26501365
// const toStep = TOTAL_STEPS - Math.floor(TOTAL_STEPS / ONE_SPAN) * ONE_SPAN
const toStep = STEPS_TO_GO_ONE_SPAN * 3

takeSteps(allRows, toStep, false)
const part2 = allRows
  .map((cells) => cells.filter((cell) => cell === 'O').length)
  .reduce(sumIt, 0)
console.log(part2)
console.timeEnd('part2')
console.log(allRows.length)

const CoDeO = () => {
  return (
    <main>
      <h2>Day 21</h2>
      <p>Part 1: calculated is {part1}, and answer is 3605.</p>
      <p>
        Part 2: calculated is {part2}, and answer is {allRows.length}{' '}
        {allRows[0].length} {startRows.length}.
      </p>
      <p>
        <Link href="/advent-of-code-2023">Back to Advent</Link>
      </p>
    </main>
  )
}

export default CoDeO
