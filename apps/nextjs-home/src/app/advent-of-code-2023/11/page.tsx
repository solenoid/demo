import Link from 'next/link'

const realInput = `...................#.............#...........................................#..............................................................
.......................................#.........#..................................................................#.........#........#....
..........#........................................................#................#............#..........................................
...#.................................................#......................................#...............................................
.................#........................................#...............................................#.....#...........................
..............................#...........#.................................................................................................
...............................................#.....................................................................................#......
.............................................................#...........................#..................................................
....#..........#...............................................................#............................................................
................................#................................................................#................#.......................#.
...........................#.............#......................#......................................#....................#...............
#..........#..........#....................................#.............#..................................................................
....................................#..............#..........................................................#........#....................
..........................................................................................#.............................................#...
............................................#.......................#..........................#............................................
.......#...........................................................................#.......................#...................#............
................#...........#.........................#.....................................................................................
................................................#...................................................................#.................#.....
....#....................................................................................#..................................................
............#.......................................................................................#.......................................
...................................#...........................#................................................#...........................
.......#.........#......#....................................................#........................................#.....#...............
......................................................#......................................#..............................................
..#.............................#............#.........................................................#....................................
...........................................................#..........#...........................#........................................#
.............#....................................#.......................................#.........................#...............#.......
.............................#..............................................................................................................
......................#....................#...................#...........#.........#.....................................#................
....................................#..................#.......................................#............#............................#..
..................#.............................#......................................................#....................................
.......#.......................#.......................................#........................................#................#..........
...........................................................................................#................................................
.....................#...........................................................................#........#..................#.......#......
...............................................................#..................#.........................................................
....#.......................................#.............#..........#......................................................................
...........................................................................#............#........................#..........................
.........#...............................................................................................................#..................
..........................#......#..........................................................................................................
..............#..................................#................#.......................................#................................#
..........................................#.................#...................#..................#........................................
.....................................................................................................................................#......
.............................#......................#..................................#..............................#.....................
.....................................#.........................................................................#...........#................
........#..................................................................#................................................................
.#..........................................#........................................................#......................................
....................#..............................................................................................#........................
..........................#........#..........................#......................#...........................................#..........
.......................................................#....................................................................................
................#................................#...........................#...........#.........#...................................#....
......................................................................#.....................................................................
.......................#....................................#.....................#..........#..............................................
........................................#...................................................................................................
..........#..........................................................................................#...........#..........................
...#.........................#....................#.........................................................................................
........................................................................#................................................#..............#...
............................................................................................................................................
.......................#..............................#......#..........................#...................................................
.............................................................................#................................#.......#.....................
............................................................................................................................................
................#..................................#.........................................................................#............#.
...........................#.........#..............................#.....#........#................................................#.......
......................#.............................................................................#......#................................
.........#.....................................#........................................................................#...................
..............#................................................#...............................#............................................
.....#...........................#.....................................................................#....................................
....................................................................................#..............................................#........
............................#..............#.......#......................................#................................................#
...........#.............................................#................#.....#.....................................#.....................
....................#............................................................................#...........................#..............
...................................#.............................................................................#...................#......
....#.........#.....................................................#......................................#................................
.........................#......................#..........#................#...............................................................
...................................................................................#......#.................................................
.................#.............................................#............................................................................
.............................#.....................#.................................................#......................................
.........#.............#..................................................................................#........................#........
.......................................#.................................#.....................#......................#...................#.
...............................................#................................#...........................................................
..#....................................................#............#.............................................#...........#.............
............................................................................................................................................
....................................#..............#............#...........................................................................
...........#...................#........................................#.................#..............#.................................#
....................#...............................................................#...............#.......................................
...........................................#...................................#..............................#.......#.....................
......#..........................................#.........#.........#..........................#................................#..........
..............#.............................................................................................................................
............................................................................................................................................
...#...........................................................#.....................................#.....#..............#.................
............................................................................................................................................
........................................#.......#.........#..................#....................................#.......................#.
.....................................................................................................................................#......
.................#.....#........#..........................................................#.................#..............................
.....................................#.................#.................#...............................................#.....#............
.........................................................................................................#..................................
..................................................................#.........................................................................
..............................................#...........#....................#.........................................................#..
..................................#.........................................................................................................
..........#..........................................................................#.......................#.....#........................
.....#..............#.......#..................................#............................................................................
............................................#.................................................#............................#.......#........
..............#..........................................#.................................................................................#
..........................................................................#..........................#......................................
.................................#..............................................#......#....................................................
#.......#..................................................................................................#.....#......................#...
........................................#..........#........................................................................................
............................................................................................#..............................#................
...........................#..........................................#.....................................................................
....................#..........................#..................................................................................#.........
..........................................................#.............................#.......#.............#.............................
#......#........#...................#..............................#.................................................#......................
.........................#.................#..............................#....................................................#............
..............................#....................................................#................#.......................................
................................................................................................................#........#..................
...........#...........................#............#.......................................................................................
...................#.........................................................................#..............................................
...........................................................................#.........#..........................................#...........
..#.............................#..................................#..................................#.............#.......................
................#........#...............#..................................................................#........................#......
...........................................................................................#................................................
..................................................#......#.....................#............................................................
#.........................................................................................................................#.................
......#............#..........................#.............................................................................................
..............#........................................................................#..........................#.........................
................................#............................................................................................#..............
.......................#.........................#......................#..................#.............................................#..
..#.....................................................#.......................#................#.......#..................................
............................................................................................................................................
..............................................................#.............................................................................
...................#.....................#..........................................................................#..........#............
.........#..........................................................................................#.......................................
..........................#......#...............#.....#....................................................................................
.............#.........................................................#......................#.............................................
............................................................#..................#........................#................................#..
..................#....................................................................................................#........#...........
.....#.....................................................................#.................................#..............................
..................................................#.........................................................................................
.....................................#..............................................#........#......#...............................#.......
............................................................................................................................................
...........................#............................#..........#......................................................#.................
#............#.......#...................................................#.......................#..........................................`

const sampleInput = `...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....`

const sumIt = (prev: number, item: number) => prev + item

const useTestInput = false
const input = useTestInput ? sampleInput : realInput
console.log(new Date())
// let rows
const rows: number[] = input
  .split('\n')
  .map((line, i) => {
    if (line.match(/^\.+$/)) {
      return i
    }
    return null
  })
  .filter(Boolean) as number[]

const lines1 = input.split('\n')
let cols: number[] = []
for (let i = 0; i < lines1[0].length - 1; i++) {
  const colIsAllDots = lines1
    .map((line) => line[i])
    .every((cell) => cell === '.')
  if (colIsAllDots) {
    cols.push(i)
  }
}

let galaxyCount = 0
let galaxies: number[] = []
let pos: Array<[number, number, number]> = []
const lines = lines1.map((line, y) => {
  const exploded = line.split('')
  return exploded
    .map((d, x) => {
      if (d === '#') {
        galaxyCount++
        galaxies.push(galaxyCount)
        pos.push([x, y, galaxyCount])
      }
      if (cols.includes(x) && rows.includes(y)) return '╋'
      if (cols.includes(x)) return '┃'
      if (rows.includes(y)) return '━'
      return d
    })
    .join('')
})

const pairs = (list: number[]) => {
  let ret: Array<[number, number]> = []
  for (let i = 0; i < list.length; i++) {
    for (let j = 0; j < list.length; j++) {
      if (
        i !== j &&
        !ret.find((item) => item[0] === list[j] && item[1] === list[i])
      ) {
        ret.push([list[i], list[j]])
      }
    }
  }
  return ret
}
const galaxyPairs = pairs(galaxies)

/** m is the multiplier with 1 already subtracted */
const findDistanceFactory =
  (m: number) =>
  ([g1, g2]: [number, number]) => {
    const [x1, y1] = pos.find((d) => d[2] === g1) ?? [0, 0]
    const [x2, y2] = pos.find((d) => d[2] === g2) ?? [0, 0]
    const xMin = Math.min(x1, x2)
    const xMax = Math.max(x1, x2)
    const yMin = Math.min(y1, y2)
    const yMax = Math.max(y1, y2)
    const xGaps = cols.filter((col) => col > xMin && col < xMax).length
    const yGaps = rows.filter((row) => row > yMin && row < yMax).length
    const xD = xMax - xMin + xGaps * m
    const yD = yMax - yMin + yGaps * m
    return xD + yD
  }

const part1 = galaxyPairs.map(findDistanceFactory(2 - 1)).reduce(sumIt, 0)
console.log(part1)
console.log(new Date())

const part2 = galaxyPairs
  .map(findDistanceFactory(1_000_000 - 1))
  .reduce(sumIt, 0)
console.log(part2)

const CoDeO = () => {
  return (
    <main>
      <div style={{ display: 'flex', flexDirection: 'row' }}>
        <div>
          <h2>Day 11</h2>
          <p>Part 1: calculated is {part1}, and answer is 9684228.</p>
          <p>Part 2: calculated is {part2}, and answer is 483844716556.</p>
          <p>
            <Link href="/advent-of-code-2023">Back to Advent</Link>
          </p>
        </div>
        <div>
          <pre
            style={{
              border: 'solid 1px grey',
              padding: '8px 10px 12px',
              margin: 20,
              fontSize: 4,
              lineHeight: 1,
            }}
          >
            <code>{lines.join('\n')}</code>
          </pre>
        </div>
      </div>
    </main>
  )
}

export default CoDeO
